import{A as T,B as m,C as P,E as et,F as rt,G as it,H as ot,I as st,J as O,K as F,L as nt,M as at,N as pt,O as ct,P as ut,Q as lt,R as L,S as dt,T as ht,U as $,V as mt,W as N,X as yt,Y as ft,Z as w,_,ba as gt,ca as St,y as Q,z as tt}from"./chunk-PHCOQDDI.js";import{Aa as C,a as u,aa as A,b as h,j as X,n as a,o as d,oc as B,q as J,s as q,u as D}from"./chunk-IDE3SQBV.js";function y(){return(n,t,e)=>{ot(n,t);let r=e.get;return e.get=function(...i){let o=lt(this),s=o?.get(r);if(T(s?.isObservable))return s?.value;if(m(s)||s.sequenceId!==L()){o.delete(r);let f=r.apply(this,i);return o.set(r,{value:f,sequenceId:L(),isObservable:dt(f)}),f}return s?.value},e}}function G(n){return String(n).replaceAll(/\/\/.*$/gm,"").replaceAll(/\s+/g,"").replaceAll(/\/\*[^*/]*\*\//g,"").split("){",1)?.[0]?.replace(/^[^(]*\(/,"").replaceAll(/=[^,]+/g,"").split(",").filter(Boolean)??[]}var xt={cancelUncompleted:!0,insideZone:!1,subscribeRequired:!0};function p(n={}){let t=Ot(n);return(e,r,i)=>{tt(e,i);let o=i.value,s=r.toString();return i.value=function(...g){let f=this,x=null,Z=F.getRepositoryByInstance(f),Y=Z.operations,S=Y[s],z=m(S),j=Z.stateMeta,H=ht(o);if(z){let K=G(o),Mt=at({statePath:j.path,methodName:s,argumentsNames:K,argumentRegistry:H});S=Y[s]={type:Mt,options:{cancelUncompleted:t.cancelUncompleted??!1}},j.actions[S.type]=[{type:S.type,options:S.options,fn:S.type}]}let U=F.ensureMappedState(j),At=U.instance;At[S.type]=()=>(T(t.insideZone)?O.ngZone?.run(()=>{x=o.apply(f,g)}):x=o.apply(f,g),q(x)&&T(t.subscribeRequired)?J(null).pipe(D(()=>x)):x),z&&O.factory.hydrateActionMetasMap(h(u({},U),{actions:{[S.type]:U.actions[S.type]}}));let It=F.createAction(S.type,g,H),Et=O.store.dispatch(It);return q(x)?ut(Et,x):x},i}}function Ot(n){let t=O?.injector?.get(Q,void 0,{optional:!0}),e=u({},xt);return P(t)&&t?.dataActionSubscribeRequired!==void 0&&(e.subscribeRequired=t.dataActionSubscribeRequired),u(u({},e),n)}var vt=300;function bt(n=vt){let t=null;return(e,r,i)=>{let o=i.value;return i.value=function(...s){ct(),O.ngZone?.runOutsideAngular(()=>{window.clearTimeout(t),t=window.setTimeout(()=>{let g=o.apply(this,s);B()&&P(g)&&console.warn("WARNING: If you use asynchronous actions `@Debounce() @DataAction()` the return result type should only void instead:",g)},n)})},i}}function Rt(n){return(t,e,r)=>{let i=n.trim();if(!i)throw new Error("Argument name should be initialized");$(t,e).createArgumentName(i,e,r)}}function l(n){return(t,e,r)=>{let i=n.trim();if(!i)throw new Error("Payload name should be initialized");$(t,e).createPayloadType(i,e,r)}}function Dt(n){return t=>{let e=_(t),r=st(t);if(m(e.name)||m(r))throw new Error("@Persistence should be add before decorator @State and @StateRepository");nt.onInit(()=>{let o=gt(r,t,n);St(o)})}}function Ct(){return n=>{let t=_(n);if(m(t.name))throw new Error("@StateRepository should be add before decorator @State");mt(n,t);let e=pt(n);Nt(n,t,e),ft(n)}}function Nt(n,t,e){Object.defineProperties(n.prototype,{name:{enumerable:!0,configurable:!0,value:t.name},initialState:{enumerable:!0,configurable:!0,get(){return et(e)}},context:yt(n)})}var v=(()=>{let t=class t{constructor(){this._dirty=!0,this.browserStorageEvents$=new X,this.isInitialised=!1,this.isBootstrapped=!1}get dirty(){return this._dirty}set dirty(r){this._dirty=r}ngxsOnChanges(r){this.dirty&&this.isBootstrapped&&(this.dirty=!1,this.ngxsDataDoCheck?.())}ngxsOnInit(){this.isInitialised=!0}ngxsAfterBootstrap(){this.isBootstrapped=!0,this.dirty&&(this.dirty=!1,this.ngxsDataDoCheck?.())}markAsDirtyAfterReset(){this.dirty=!0,this.ngxsDataAfterReset?.()}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=A({token:t,factory:t.\u0275fac});let n=t;return n})();var I=class I extends v{get snapshot(){return N(this.getState())}get ctx(){return w(this.context)}patchState(t){this.ctx.patchState(t)}setState(t){this.ctx.setState(t)}reset(){this.ctx.setState(this.initialState),this.markAsDirtyAfterReset()}getState(){return this.ctx.getState()}dispatch(t){return this.ctx.dispatch(t)}};I.\u0275fac=(()=>{let t;return function(r){return(t||(t=C(I)))(r||I)}})(),I.\u0275prov=A({token:I,factory:I.\u0275fac});var b=I;a([y()],b.prototype,"snapshot",null);a([p(),d(0,l("patchValue"))],b.prototype,"patchState",null);a([p(),d(0,l("stateValue"))],b.prototype,"setState",null);a([p()],b.prototype,"reset",null);var V=function(n){return n.ID="id",n}(V||{});var k=function(n){return n.ASC="asc",n.DESC="desc",n}(k||{});var E=class E extends v{constructor(){super(...arguments),this.primaryKey=V.ID,this.comparator=null}get snapshot(){return N(this.getState())}get ids(){return this.snapshot.ids}get entities(){return this.snapshot.entities}get entitiesArray(){let t=this.snapshot;return t.ids.map(e=>t.entities[e])}get ids$(){return this.state$.pipe(D(t=>t.ids))}get entities$(){return this.state$.pipe(D(t=>t.entities))}get entitiesArray$(){return this.state$.pipe(D(t=>t.ids.map(e=>t.entities[e])))}get ctx(){return w(this.context)}reset(){this.setEntitiesState(this.initialState),this.markAsDirtyAfterReset()}addOne(t){this.addEntityOne(t)}addMany(t){this.addEntitiesMany(t)}setOne(t){this.setEntityOne(t)}setMany(t){this.setEntitiesMany(t)}setAll(t){this.setEntitiesAll(t)}updateOne(t){this.updateEntitiesMany([t])}updateMany(t){this.updateEntitiesMany(t)}upsertOne(t){this.upsertEntitiesMany([t])}upsertMany(t){this.upsertEntitiesMany(t)}removeOne(t){this.removeEntitiesMany([t])}removeMany(t){this.removeEntitiesMany(t)}removeByEntity(t){let e=this.selectId(t);this.removeEntitiesMany([e])}removeByEntities(t){let e=[];for(let r of t){let i=this.selectId(r);e.push(i)}this.removeEntitiesMany(e)}removeAll(){this.setAll([])}sort(t){if(this.comparator=t??this.comparator,m(this.comparator)){console.warn("You must set the compare function before sorting.");return}this.setEntitiesState(this.getState())}patchState(t){this.ctx.patchState(t)}setComparator(t){return this.comparator=t,this}dispatch(t){return this.ctx.dispatch(t)}getState(){return this.ctx.getState()}selectId(t){return t?.[this.primaryKey]}selectOne(t){return this.snapshot.entities[t]??null}selectAll(){let t=this.getState();return t.ids.map(e=>t.entities[e])}addEntityOne(t){let e=this.getState(),r=this.selectIdValue(t);r in e.entities||this.setEntitiesState(h(u({},e),{ids:[...e.ids,r],entities:h(u({},e.entities),{[r]:t})}))}addEntitiesMany(t){let e=this.getState(),r={},i=[];for(let o of t){let s=this.selectIdValue(o);s in e.entities||s in r||(i.push(s),r[s]=o)}i.length>0&&this.setEntitiesState(h(u({},e),{ids:[...e.ids,...i],entities:u(u({},e.entities),r)}))}setEntitiesAll(t){let e=this.getState(),r={},i=[];for(let o of t){let s=this.selectIdValue(o);s in r||(i.push(s),r[s]=o)}this.setEntitiesState(h(u({},e),{ids:i,entities:r}))}setEntityOne(t){let e=this.getState(),r=this.selectIdValue(t);r in e.entities?this.setEntitiesState(h(u({},e),{entities:h(u({},e.entities),{[r]:t})})):this.setEntitiesState(h(u({},e),{ids:[...e.ids,r],entities:h(u({},e.entities),{[r]:t})}))}setEntitiesMany(t){for(let e of t)this.setEntityOne(e)}updateEntitiesMany(t){let e=this.getState(),r=t.filter(s=>s.id in e.entities);if(r.length===0)return;let i=this.generateKeyMap(e),o=u({},e.entities);for(let s of r){let g=this.updateOrigin(o,s),f=this.selectIdValue(g);f!==s.id&&(delete i[s.id],delete o[s.id]),i[s.id]=f,o[f]=g}this.setEntitiesState(h(u({},e),{ids:e.ids.map(s=>i[s]??s),entities:o}))}upsertEntitiesMany(t){let e=this.getState(),r=[],i=[];for(let o of t){let s=this.selectIdValue(o);s in e.entities?r.push({id:s,changes:o}):i.push(o)}this.updateMany(r),this.addMany(i)}removeEntitiesMany(t){let e=this.getState(),r=this.generateKeyMap(e),i=u({},e.entities);for(let o of t)o in i&&(delete r[o],delete i[o]);this.setEntitiesState(h(u({},e),{ids:e.ids.filter(o=>o in r),entities:i}))}setEntitiesState(t){let e=this.sortKeysByComparator(t.ids,t.entities);this.ctx.patchState(h(u({},t),{ids:e,entities:t.entities}))}sortKeysByComparator(t,e){if(m(this.comparator))return t;let r=t.slice(),i=this.comparator;return typeof i=="function"?r.sort((o,s)=>i(e[o],e[s])):this.sortByComparatorOptions(r,i,e)}sortByComparatorOptions(t,e,r){switch(e?.sortByOrder){case k.ASC:return t.sort((i,o)=>rt(e?.sortBy,r[i],r[o]));case k.DESC:return t.sort((i,o)=>it(e?.sortBy,r[i],r[o]));default:return B()&&console.warn(`Invalid --> { sortByOrder: "${e?.sortByOrder}" } not supported!`),t}}generateKeyMap(t){return t.ids.reduce((e,r)=>(e[r]=r,e),{})}updateOrigin(t,e){let r=t[e.id];return u(u({},r),e.changes)}selectIdValue(t){let e=this.selectId(t);return m(e)&&B()&&console.warn(`The entity passed to the 'selectId' implementation returned ${e}.`,"You should probably provide your own 'selectId' implementation.","The entity that was passed:",t,"The current `selectId` implementation: (entity: V): K => entity.id"),e}};E.\u0275fac=(()=>{let t;return function(r){return(t||(t=C(E)))(r||E)}})(),E.\u0275prov=A({token:E,factory:E.\u0275fac});var c=E;a([y()],c.prototype,"snapshot",null);a([y()],c.prototype,"ids",null);a([y()],c.prototype,"entities",null);a([y()],c.prototype,"entitiesArray",null);a([y()],c.prototype,"ids$",null);a([y()],c.prototype,"entities$",null);a([y()],c.prototype,"entitiesArray$",null);a([p()],c.prototype,"reset",null);a([p(),d(0,l("entity"))],c.prototype,"addOne",null);a([p(),d(0,l("entities"))],c.prototype,"addMany",null);a([p(),d(0,l("entity"))],c.prototype,"setOne",null);a([p(),d(0,l("entities"))],c.prototype,"setMany",null);a([p(),d(0,l("entities"))],c.prototype,"setAll",null);a([p(),d(0,l("update"))],c.prototype,"updateOne",null);a([p(),d(0,l("updates"))],c.prototype,"updateMany",null);a([p(),d(0,l("entity"))],c.prototype,"upsertOne",null);a([p(),d(0,l("entities"))],c.prototype,"upsertMany",null);a([p(),d(0,l("id"))],c.prototype,"removeOne",null);a([p(),d(0,l("ids"))],c.prototype,"removeMany",null);a([p(),d(0,l("entity"))],c.prototype,"removeByEntity",null);a([p(),d(0,l("entities"))],c.prototype,"removeByEntities",null);a([p()],c.prototype,"removeAll",null);a([p(),d(0,l("comparator"))],c.prototype,"sort",null);a([p(),d(0,l("patchValue"))],c.prototype,"patchState",null);var M=class M extends v{get snapshot(){return N(this.getState())}get ctx(){return w(this.context)}patchState(t){this.ctx.patchState(t)}setState(t){this.ctx.setState(t)}reset(){this.ctx.setState(this.initialState),this.markAsDirtyAfterReset()}getState(){return this.ctx.getState()}dispatch(t){return this.ctx.dispatch(t)}};M.\u0275fac=(()=>{let t;return function(r){return(t||(t=C(M)))(r||M)}})(),M.\u0275prov=A({token:M,factory:M.\u0275fac});var R=M;a([y()],R.prototype,"snapshot",null);a([p(),d(0,l("patchValue"))],R.prototype,"patchState",null);a([p(),d(0,l("stateValue"))],R.prototype,"setState",null);a([p()],R.prototype,"reset",null);export{y as a,p as b,bt as c,Rt as d,l as e,Dt as f,Ct as g,b as h,c as i,R as j};
